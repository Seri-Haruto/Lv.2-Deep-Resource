<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ありがとうございました｜心のぐるぐる描画</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <main class="container container--narrow">
    <section class="card center-card">
      <div class="head"><h2>ご協力ありがとうございました</h2></div>
      <div class="body" style="text-align:center;">
        <p>全10回の提出が完了しました．研究にご協力いただきありがとうございます．</p>

        <!-- 参加者ID表示 -->
        <div class="pill" style="justify-content:center; margin:10px 0;">
          <strong>参加者ID：</strong><span id="finalId">---</span>
        </div>

        <hr style="margin:16px 0;">

        <!-- クラウドワークス用 合言葉 -->
        <h3 style="margin:6px 0 8px;">クラウドワークスへの入力</h3>
        <p class="small">クラウドワークス上の作業完了画面に次の合言葉と参加者IDを入力してください．</p>
        <div class="center-actions" style="margin:10px 0 14px;">
          <div class="badge" id="cwKeyword" aria-live="polite">どら焼き</div>
        </div>

        <hr style="margin:16px 0;">

        <!-- 撤回について（3日明示） -->
        <h3 style="margin:6px 0 8px;">撤回について</h3>
        <p class="small dim" style="margin-top:4px;">
          撤回は<strong>3日以内</strong>であれば申請することができます．<p>
          撤回には参加者IDが必要です．
        </p>
        <p class="small" style="margin-top:6px;">
          <a class="link" href="/withdraw">撤回申請フォームへ</a>
        </p>
      </div>
    </section>
  </main>

  <footer class="container container--narrow"><small>© 2025 Osawa Lab</small></footer>

  <script>
    (function(){
      const MAX_TRIALS = 10;

      // 完了者以外は描画ページへ戻す
      const tc = parseInt(localStorage.getItem('trial_count') || '0', 10);
      if (isNaN(tc) || tc < MAX_TRIALS) {
        location.href = '/draw';
        return;
      }

      // 参加者ID表示
      const pid = localStorage.getItem('participant_id') || '未発行';
      document.getElementById('finalId').textContent = pid;

      // 合言葉コピー
      const copyBtn = document.getElementById('copyCw');
      copyBtn?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText('どら焼き');
          alert('合言葉をコピーしました．');
        } catch {
          alert('コピーに失敗しました．手動で入力してください：どら焼き');
        }
      });
    })();
  </script>
</body>
</html>
